<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- 
      1. USAMOS EL FRAGMENTO 'head' ESTÁNDAR.
      Esto nos da automáticamente:
      - Los enlaces a CSS de Bootstrap (desde WebJars) y tu custom.css.
      - La meta etiqueta 'viewport' para la responsividad.
      - Los meta tokens de seguridad CSRF.
    -->
    <div th:replace="~{fragments/header :: head(pageTitle='Gestión de Productos')}"></div>
</head>

<!-- 
  2. USAMOS LA ESTRUCTURA DE BODY ESTÁNDAR.
  Esto asegura que el footer se quede abajo y que el tema oscuro (o el que sea) sea consistente.
-->
<body class="d-flex flex-column min-vh-100 bg-primary text-white">

    <!-- 
      3. USAMOS TU HEADER DE ADMINISTRACIÓN ESPECÍFICO.
      Esto es perfecto. Mantenemos el header que has creado para la sección de admin.
    -->
    <div th:replace="~{fragments/header :: header}"></div>
    
    <!-- 
      4. ENVOLVEMOS EL CONTENIDO PRINCIPAL EN UNA ETIQUETA <main>.
      Esto es bueno para la semántica y para el layout de flexbox.
    -->
    <main class="container my-5 flex-grow-1">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">Gestión de Productos Digitales</h2>
            <a href="/admin/productos/nuevo" class="btn btn-light">+ Nuevo Producto</a>
        </div>

        <div class="table-responsive">
            <!-- He añadido 'table-dark' para que la tabla se integre mejor con el tema oscuro -->
            <table class="table table-striped table-bordered align-middle shadow-sm table-dark">
                <thead class="thead-light"> <!-- Un color más claro para el header de la tabla puede mejorar la legibilidad -->
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio (€)</th>
                        <th>Stock</th>
                        <th>Tipo</th>
                        <th>Region</th>
                        <th>Plataforma</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tu bucle 'th:each' no necesita cambios, está perfecto -->
                    <tr th:each="p : ${productos}">
                        <td th:text="${p.id}">1</td>
                        <td th:text="${p.nombre}">Nombre</td>
                        <td th:text="${p.precio}">0.0</td>
                        <td th:text="${p.stock}">0</td>
                        <td th:text="${p.tipo}">Categoria</td>
                        <td th:text="${p.region}">Region</td>
                        <td th:text="${p.plataforma}">Plataforma</td>
                        <td>
                            <div class="d-flex flex-wrap gap-2">
                                <a th:href="@{'/admin/productos/editar/' + ${p.id}}" class="btn btn-sm btn-outline-light">Editar</a>
                                <a th:href="@{'/admin/productos/eliminar/' + ${p.id}}" class="btn btn-sm btn-outline-danger">Eliminar</a>
                                <a th:href="@{'/admin/productos/' + ${p.id} + '/importar-claves'}" class="btn btn-sm btn-outline-info">Importar Claves</a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </main>

    <!-- 5. AÑADIMOS EL FOOTER ESTÁNDAR -->
    <div th:replace="~{fragments/footer :: footer}"></div>
    
    <!-- 6. USAMOS EL FRAGMENTO DE SCRIPTS. -->
    <!-- Esto elimina el enlace al CDN y carga nuestros scripts comunes (Bootstrap JS, etc.) -->
    <div th:replace="~{fragments/scripts :: scripts}"></div>
    
</body>

</html>