<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{fragments/header :: head(pageTitle=${pageTitle})}"></div>
</head>
<body class="d-flex flex-column min-vh-100 bg-dark text-white">
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="container my-5 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card bg-dark text-white border-secondary">
                    <div class="card-header bg-secondary-subtle text-dark">
                        <h3 th:text="${pageTitle}">Formulario de Producto</h3>
                    </div>
                    <div class="card-body">
                        <!--
                          CAMBIO IMPORTANTE:
                          Añadimos enctype="multipart/form-data" para permitir la subida de archivos.
                        -->
                        <form th:action="@{/panel-vendedor/productos/guardar}" 
                              th:object="${productoFisico}" 
                              method="post" 
                              enctype="multipart/form-data">
                            
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" th:field="*{id}" />

                            <!-- ... campos de nombre, descripción ... -->
 <!-- Campo: Nombre -->
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre del Producto</label>
                                <input type="text" th:field="*{nombre}" class="form-control" id="nombre" required>
                            </div>

                            <!-- Campo: Descripción -->
                            <div class="mb-3">
                                <label for="descripcion" class="form-label">Descripción</label>
                                <textarea th:field="*{descripcion}" class="form-control" id="descripcion" rows="4"></textarea>
                            </div>
                            <!--
                              ========= CAMPO DE IMAGEN MODIFICADO =========
                            -->
                            <div class="mb-3">
                                <label for="imagenFile" class="form-label">Subir Imagen</label>
                                <!--
                                  El input ahora es de tipo "file".
                                  El 'name' debe coincidir con el @RequestParam del controlador.
                                -->
                                <input type="file" name="imagenFile" class="form-control" id="imagenFile" accept="image/png, image/jpeg, image/webp">
                                
                                <!-- Mostramos la imagen actual si estamos editando un producto que ya tiene una -->
                                <div th:if="${productoFisico.id != null and productoFisico.imagenUrl != null}" class="mt-2">
                                    <p class="small mb-1">Imagen actual:</p>
                                    <img th:src="${productoFisico.imagenUrl}" alt="Imagen actual" style="max-width: 100px; border-radius: 8px;">
                                </div>
                                <div class="form-text text-light mt-1">
                                    Sube una nueva imagen para cambiarla. Si no seleccionas ninguna, se mantendrá la actual.
                                </div>
                            </div>
                            <!-- ============================================ -->
                            
                            <!-- ... campo de precio y botón de guardar ... -->
                             <div class="mb-3">
                                <label for="precio" class="form-label">Precio (€)</label>
                                <input type="number" th:field="*{precio}" class="form-control" id="precio" step="0.01" required>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary text-white">Guardar Producto</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <div th:replace="~{fragments/scripts :: scripts}"></div>
</body>
</html>